#!/bin/bash
#Ember Offline Git UPdater
set -e
rubberfs save || error-notify "ERROR running rubberfs save!"
set +e
(
    set -e
    cd /Ember\ Library || error-notify "Could not open Ember Library directory!"
    cd Ember\ satellite\ projects/wreathe-overlay || error-notify "Could not open wreathe-overlay directory!"
    set +e
    repoman manifest
    set -e
    cd ../.. error-notify "Could not leave directory!"
    set +e
    findemberfolders() {
        find . -maxdepth 1 -not -name '\.*' -type d -print0 | xargs -i{} -0 -P 15 sh -c 'eogup-single "$1"' -- '{}' \;
    }
    set -e
    (
        cd Ember || error-notify "Could not open Ember directory!"
        findemberfolders || error-notify "ERROR running Ember folders update!"
    )
    (
        cd Ember\ satellite\ projects || error-notify "Could not open Ember satellite projects directory!"
        findemberfolders || error-notify "ERROR running satellite projects update!"
    )
    eogup-single /Ember
    eogup-single /Ember\ satellite\ projects || warn "Note: failed updating satellite projects meta-repository; this is normal if you only have a partial clone of the Ember tree"
)
eogup-single /Ember\ Library || warn "Note: failed updating Ember meta-repository; this is normal if you only have a partial clone of the Ember tree"
printf "\033c"
echo "Done updating."
